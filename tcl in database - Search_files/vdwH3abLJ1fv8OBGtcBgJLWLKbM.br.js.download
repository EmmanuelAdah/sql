var CreatorCardTextInlineEdit;(function(n){let t;(function(n){n.Hidden="hidden";n.Visible="visible"})(t||(t={}));class i{constructor(n,i,r,u,f={render:n=>n},e,o,s,h,c){var l,a,v,y,p,w,b,k;this.answerContainer=n;this.responseDiv=i;this.inputData=r;this.polling=u;this.markdownIt=f;this.copyToClipboardByCommand=e;this.logInstrument=o;this.pollingCustomization=s;this.sendAPSAT=h;this.addResponse=c;this.currentParagraph=null;this.currentParagraphOldMdContent="";this.currentParagraphNewMdContent="";this.isMouseOnPanelOrParagraph=!1;this.mdParagraphs=[];this.handleParagraphMouseOver=n=>{var r;const i=n.target.closest(".b_paragraph[data-md-index]");i!==this.currentParagraph&&((r=this.currentParagraph)===null||r===void 0?void 0:r.classList.remove("b_paragraph_selected"));i?(i.addEventListener("mouseleave",this.handleParagraphMouseLeave),this.currentParagraph=i,this.currentParagraph.classList.add("b_paragraph_selected"),this.isMouseOnPanelOrParagraph=!0,this.setActionPanelPosition(i),this.toggleElementVisibility(this.actionPanel,t.Visible)):(this.currentParagraph=null,this.isMouseOnPanelOrParagraph=!1,this.toggleElementVisibility(this.actionPanel,t.Hidden))};this.handleParagraphMouseLeave=()=>{this.isMouseOnPanelOrParagraph=!1,setTimeout(()=>{this.isMouseOnPanelOrParagraph||this.toggleElementVisibility(this.actionPanel,t.Hidden)},100)};this.handleActionPanelMouseEnter=()=>{this.isMouseOnPanelOrParagraph=!0,this.toggleElementVisibility(this.actionPanel,t.Visible)};this.handleActionPanelMouseLeave=()=>{this.isMouseOnPanelOrParagraph=!1,setTimeout(()=>{this.isMouseOnPanelOrParagraph||this.toggleElementVisibility(this.actionPanel,t.Hidden)},100)};console.log("CreatorCardTextInlineEdit initialized");this.actionPanel=_d.querySelector(".b_cnt_action_panel");this.paragraphCopyBtn=_d.getElementById("b_paragraph_copy");this.paragraphShorterBtn=_d.getElementById("b_paragraph_shorter");this.paragraphLongerBtn=_d.getElementById("b_paragraph_longer");this.paragraphPreviewPanelModalOverlay=_d.querySelector(".b_cnt_edit_preview_modal_overlay");this.paragraphPreviewPanelCloseBtn=_d.getElementById("b_paragraph_preview_close");this.paragraphPreviewPanelRetryBtn=_d.getElementById("b_paragraph_preview_retry");this.paragraphPreviewPanelReplaceBtn=_d.getElementById("b_paragraph_preview_replace");this.paragraphPreviewLoading=_d.querySelector(".b_paragraph_preview_loading");this.paragraphPreviewContent=_d.querySelector(".b_paragraph_preview_content");this.paragraphCopyText=this.paragraphCopyBtn.querySelector(".b_paragraph_copy_text");this.actionPanel.addEventListener("mouseenter",this.handleActionPanelMouseEnter);this.actionPanel.addEventListener("mouseleave",this.handleActionPanelMouseLeave);(l=this.paragraphCopyBtn)===null||l===void 0?void 0:l.addEventListener("click",()=>this.handleParagraphAction("Copy"));(a=this.paragraphShorterBtn)===null||a===void 0?void 0:a.addEventListener("click",()=>this.handleParagraphAction("Make Shorter"));(v=this.paragraphLongerBtn)===null||v===void 0?void 0:v.addEventListener("click",()=>this.handleParagraphAction("Make Longer"));(y=this.paragraphPreviewPanelCloseBtn)===null||y===void 0?void 0:y.addEventListener("click",()=>this.handleParagraphPreviewPanelClose());(p=this.paragraphPreviewPanelRetryBtn)===null||p===void 0?void 0:p.addEventListener("click",()=>this.handleParagraphPreviewPanelRetry());(w=this.paragraphPreviewPanelReplaceBtn)===null||w===void 0?void 0:w.addEventListener("click",()=>this.handleParagraphPreviewPanelReplace());(b=this.responseDiv)===null||b===void 0?void 0:b.addEventListener("mouseover",n=>this.handleParagraphMouseOver(n));(k=this.paragraphPreviewPanelModalOverlay)===null||k===void 0?void 0:k.addEventListener("click",n=>this.handleParagraphPreviewPanelModalOverlayClick(n))}updateParagraphPreviewContent(n,i){var r;if(this.paragraphPreviewPanelModalOverlay&&this.currentParagraph){const u=n?((r=JSON.parse(i))===null||r===void 0?void 0:r.text)||"":i;this.currentParagraphNewMdContent=u;this.paragraphPreviewContent.innerHTML=this.markdownIt.render(this.currentParagraphNewMdContent);this.toggleElementVisibility(this.paragraphPreviewLoading,t.Hidden);this.toggleElementVisibility(this.paragraphPreviewContent,t.Visible);this.paragraphPreviewPanelRetryBtn.disabled=!1;this.paragraphPreviewPanelReplaceBtn.disabled=!1}}handleParagraphIndex(n){this.mdParagraphs=n.split(/\n\s*\n/);let t="";return this.mdParagraphs.forEach((n,i)=>{let r=this.markdownIt.render(n);r=r.slice(0,5)==="<pre>"?r:`<section class="b_paragraph" data-md-index="${i}">${r}</section>`;t+=r},this),t}copyParagraph(){const n=this.currentParagraph;if(n){const t=this.paragraphCopyBtn.dataset.title||"Copy Text";if(this.paragraphCopyText.innerText=this.paragraphCopyText.dataset.copiedtext||t,navigator.clipboard){const t=new ClipboardItem({"text/html":new Blob([n.innerText],{type:"text/html"}),"text/plain":new Blob([n.innerText],{type:"text/plain"})});navigator.clipboard.write([t]);this.logInstrument("ParagraphCopySucceed")}else this.copyToClipboardByCommand(n)}}editParagraph(n){this.currentParagraphInlineEditAction=n;this.showParagraphPreviewPanel();const t=`Length: 
** ${n}`;this.inputData.customizationMode="Inline";this.inputData.refineContent=this.currentParagraphOldMdContent;this.pollingCustomization(t,[n])}setActionPanelPosition(n){const i=this.answerContainer.getBoundingClientRect(),r=n.getBoundingClientRect();let t=r.bottom-i.top-24;const e=r.right-i.left-this.actionPanel.offsetWidth,u=this.actionPanel.offsetHeight,f=i.height;t+u>f&&(t=f-u,t<0&&(t=0));this.actionPanel.style.top=`${t}px`;this.actionPanel.style.left=`${e}px`}handleParagraphAction(n){const i=this.currentParagraph;if(i){const t=Number(i.dataset.mdIndex);if(!isNaN(t)&&!(t<0)&&!(t>=this.mdParagraphs.length)){const r=this.mdParagraphs[t];this.currentParagraphOldMdContent=r;this.logInstrument(`Paragraph:${n}`,"Click");this.sendAPSAT(`Paragraph:${n}`);switch(n){case"Copy":this.copyParagraph();break;case"Make Shorter":this.editParagraph("Make Shorter");break;case"Make Longer":this.editParagraph("Make Longer")}}}}showParagraphPreviewPanel(){this.paragraphPreviewPanelModalOverlay&&this.currentParagraph&&(this.toggleElementVisibility(this.paragraphPreviewContent,t.Hidden),this.toggleElementVisibility(this.paragraphPreviewLoading,t.Visible),this.toggleElementVisibility(this.paragraphPreviewPanelModalOverlay,t.Visible),this.toggleElementVisibility(this.actionPanel,t.Hidden),this.paragraphPreviewPanelRetryBtn.disabled=!0,this.paragraphPreviewPanelReplaceBtn.disabled=!0)}handleParagraphPreviewPanelModalOverlayClick(n){this.paragraphPreviewPanelModalOverlay===n.target&&this.handleParagraphPreviewPanelClose()}handleParagraphPreviewPanelClose(){this.paragraphPreviewPanelModalOverlay&&(this.polling.cancel(),this.toggleElementVisibility(this.paragraphPreviewPanelModalOverlay,t.Hidden),this.toggleElementVisibility(this.paragraphPreviewContent,t.Hidden),this.toggleElementVisibility(this.paragraphPreviewLoading,t.Visible),this.isMouseOnPanelOrParagraph=!1,this.currentParagraph&&(this.currentParagraph.classList.remove("b_paragraph_selected"),this.currentParagraph=null))}handleParagraphPreviewPanelRetry(){this.logInstrument("ParagraphPreviewPanelRetry","Click");this.sendAPSAT("ParagraphPreviewPanelRetry");this.paragraphPreviewContent.innerHTML="";this.editParagraph(this.currentParagraphInlineEditAction)}handleParagraphPreviewPanelReplace(){if(this.logInstrument("ParagraphPreviewPanelReplace","Click"),this.sendAPSAT("ParagraphPreviewPanelReplace"),this.currentParagraph&&this.currentParagraphNewMdContent){const n=this.currentParagraph.dataset.mdIndex;this.currentParagraph.innerHTML=this.markdownIt.render(this.currentParagraphNewMdContent);this.currentParagraph.dataset.mdIndex=n;this.mdParagraphs[Number(n)]=this.currentParagraphNewMdContent;this.addResponse(JSON.stringify({text:this.mdParagraphs.join("\n\n")}))}this.handleParagraphPreviewPanelClose()}toggleElementVisibility(n,i){if(n&&(i===t.Visible&&n.classList.add("b_show"),i===t.Hidden&&n.classList.remove("b_show"),n===this.actionPanel)){const n=this.paragraphCopyBtn.dataset.title||"Copy Text";this.paragraphCopyText.innerText=n}}}n.CreatorCardTextInlineEdit=i})(CreatorCardTextInlineEdit||(CreatorCardTextInlineEdit={}))