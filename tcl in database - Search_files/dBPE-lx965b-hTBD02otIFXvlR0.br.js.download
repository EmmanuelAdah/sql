var __awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})},CreatorCardText;(function(n){function t(n=""){var t,i,u,f,e;let o=_w.wizardquery||"";if(!o){const s=(t=_d.querySelector("sp_requery a"))===null||t===void 0?void 0:t.innerText,h=(i=_ge("sb_form_q"))===null||i===void 0?void 0:i.value,c=(e=(f=(u=_w.WSB)===null||u===void 0?void 0:u.Host)===null||f===void 0?void 0:f.getQuery())===null||e===void 0?void 0:e.originalQuery,l=r(_w.location.search);o=s||h||c||l||n}return o}function r(n){const t=n.match(/[?&]q=([^&]+)/);return t?decodeURIComponent(t[1].replace(/\+/g," ")):""}class i{constructor(n,t){var i,r;this.isCached=!0;this.responses=[];this.responseIndex=0;this.isFirstModelSwitch=!0;this.exportDropdown=null;this._loading=!0;this.answerContainer=null;this.appNS="";this.kVal="";this.modelDropdownId="b_wpt_llm_list";this.modelName="";this.llmResponseModelName="";this.isModelChanged=!1;this.llmModelCookieKey="SRCHAV";this.llmModelCrumbKey="SERPMODEL";this.customOptionsState=new Map;this.dropdownCloseHandlers=null;this.customHeightObserver=null;this.inputData=n;this.locStrings=t;this.markdownIt=new ChatUtils.MarkdownRenderer({});try{this.checkPrerequisites();this.initElements();this.initPolling();this.loading=!0;((i=this.inputData)===null||i===void 0?void 0:i.enableInlineEdit)&&this.initInlineEdit();this.renderFirstMessage()}catch(u){this.handleError(u)}((r=this.inputData)===null||r===void 0?void 0:r.showAuthVerified)&&(this.setActionAndCustomizePanel(!0),this.undoBtn&&(this.undoBtn.disabled=!0),this.redoBtn&&(this.redoBtn.disabled=!0))}get loading(){return this._loading}set loading(n){this._loading=n;this.toggleLoading(n)}checkPrerequisites(){var n;if(this.contentDiv=_d.querySelector(".b_crtrm_cnt"),!this.contentDiv)throw new Error("Content div is missing");if(this.loadingDiv=_d.querySelector(".b_crtrm_skeleton"),!this.loadingDiv)throw new Error("Loading div is missing");if(this.responseDiv=_d.querySelector(".b_cnt_resp"),!this.responseDiv)throw new Error("Response div is missing");if(!_w.CreatorCardPolling)throw new Error("CreatorCardPolling is unavailable");this.answerContainer=_d.querySelector(".b_crtrm_wrapper");((n=this.inputData)===null||n===void 0?void 0:n.enhanceInstrumentation)&&this.answerContainer&&(this.appNS=this.answerContainer.getAttribute("data-appns")||"",this.kVal=this.answerContainer.getAttribute("data-k")||"")}initElements(){var n,t,i,r,u,f,e,o,s,h,c,l,a,v;this.isCached=!this.inputData.isStreaming;this.logInstrument("CreatorTriggered","Show");this.logInstrument("CreatorCardShow","Show");const y=_d.querySelector(".b_crtrm_toolbar");if(this.customizeDiv=_d.querySelector(".b_cus_fields_wrapper"),y&&this.logInstrument("ToolBarShow","Show"),this.customizeDiv&&(this.logInstrument("CustomizationShow","show"),this.customizeDiv.addEventListener("scroll",()=>this.handleCustomizeScroll())),this.customizeFields=_d.querySelectorAll(".b_cus_fields .b_field"),this.undoBtn=_d.getElementById("bCusUndoBtn"),this.redoBtn=_d.getElementById("bCusRedoBtn"),this.copyBtn=_d.getElementById("bCusCopyBtn"),this.exportDisclaimer=_d.getElementById("bCusExportBtn"),this.exportToolbar=_d.getElementById("bCusExportBtnToolbar"),this.recreateBtn=_d.getElementById("bCusRecreateBtn"),this.cancelBtn=_d.getElementById("bCusCancelBtn"),this.exportDropdown=_d.getElementById("bCusExportDropdown"),(n=this.undoBtn)===null||n===void 0?void 0:n.addEventListener("click",()=>this.handleUndoClick()),(t=this.redoBtn)===null||t===void 0?void 0:t.addEventListener("click",()=>this.handleRedoClick()),(i=this.copyBtn)===null||i===void 0?void 0:i.addEventListener("click",()=>this.handleCopyClick()),(r=this.exportDisclaimer)===null||r===void 0?void 0:r.addEventListener("click",()=>this.handleDocxExportClick(this.exportDisclaimer)),(u=this.exportToolbar)===null||u===void 0?void 0:u.addEventListener("click",()=>this.handleExportToolbarClick()),(f=this.recreateBtn)===null||f===void 0?void 0:f.addEventListener("click",()=>this.handleRecreateClick()),(e=this.cancelBtn)===null||e===void 0?void 0:e.addEventListener("click",()=>this.handleCancelClick()),(o=this.responseDiv)===null||o===void 0?void 0:o.addEventListener("scroll",()=>this.handleResponseScroll()),!this.inputData.isMobile&&this.inputData.enableCustomPanelHeight&&this.initCustomHeight(),this.inputData.isMobile||this.initSeeMoreButton(),this.exportDropdown){const n=this.exportDropdown.querySelectorAll(".b_crtrm_exp_option");n.forEach(n=>{const t=n;this.attachOptionEventListeners(t)})}(s=this.customizeFields)===null||s===void 0?void 0:s.forEach(n=>{n.addEventListener("change",()=>this.panelInteration())});this.inputData.isMobile&&(this.editBtn=_d.getElementById("bCusEditBtn"),(h=this.editBtn)===null||h===void 0?void 0:h.addEventListener("click",()=>this.handleEditClick()),this.editOverlayMask=_d.getElementById("crtrmMask"),(c=this.editOverlayMask)===null||c===void 0?void 0:c.addEventListener("click",()=>this.toggleEditOverlay()),this.fullscreenView=_d.querySelector(".b_crtrm_fullscreen"),this.seeAllBtn=_d.getElementById("bCusSeeAllBtn"),this.backBtn=_d.getElementById("bCusBackBtn"),(l=this.seeAllBtn)===null||l===void 0?void 0:l.addEventListener("click",()=>this.handleSeeAllClick()),(a=this.backBtn)===null||a===void 0?void 0:a.addEventListener("click",()=>this.handleBackClick()));((v=this.inputData)===null||v===void 0?void 0:v.enableSwitchModel)&&(this.modelDropdown=_ge(this.modelDropdownId),this.modelDropdown&&(this.resetModelDropdown(),sj_evt.bind("filterItems_selected",n=>{var r,i=n&&n.length>1?n[1]:undefined,t;if(i&&i.FilterControlId&&i.FilterControlId==this.modelDropdownId){if(t=i.SelectedFilterItemIds,this.currentModel=t&&t.length>0?_ge(t[0]):null,this.modelName=(t===null||t===void 0?void 0:t[0])||"",(r=this.inputData)===null||r===void 0?void 0:r.enhanceRecreateUX){const n=sj_cook.get(this.llmModelCookieKey,this.llmModelCrumbKey),t=n?this.modelName!==n:this.modelName!=="SyndicationAPI-TextToText-ModelF";t?(this.isFirstModelSwitch&&(this.saveCustomOptionsState(),this.isFirstModelSwitch=!1),this.disableCustomizeFields()):t||(this.restoreCustomOptionsState(),this.isFirstModelSwitch=!0)}this.panelInteration()}})))}initPolling(){const n={onComplete:n=>this.handlePollingResponse(n),onError:n=>this.handleError(new Error(n)),onCancel:()=>this.handleError(new Error(this.locStrings.WPTCreatorPollingCancelMessage))},t={observer:n,queryParams:this.inputData.queryParams,timeoutMs:this.inputData.pollingTimeoutMs,retryIntervalMs:this.inputData.pollingRetryIntervalMs,maxRetryCount:this.inputData.pollingMaxRetryCount,locStrings:this.locStrings,enablePollingAjaxFix:this.inputData.enablePollingAjaxFix||!1};this.polling=new CreatorCardPolling.CreatorCardPolling(t)}renderFirstMessage(){const{isStreaming:t,modelResponse:i,answerKey:r,traceId:u,metaInfoDic:n}=this.inputData;t?this.pollingMessage(r,u):(n===null||n===void 0?void 0:n.ErrorType)==="ContentFilter"?this.handleError(new Error(this.locStrings.WPTCreatorContentFilterErrorMessage)):this.addResponse(i)}addResponse(n){this.responses.length>=this.inputData.maxResponsesCount&&this.responses.shift();this.responses.push(n);this.responseIndex=this.responses.length-1;this.polling.setLastModelResponseText(n);this.switchResponse()}switchResponse(){if(this.responses.length!==0){this.undoBtn&&(this.undoBtn.disabled=this.responseIndex<=0);this.redoBtn&&(this.redoBtn.disabled=this.responseIndex>=this.responses.length-1);const n=this.responses[this.responseIndex];this.renderMessage(n);this.loading=!1;this.handleToggleCancelButton(!1)}}renderMessage(n){const t=JSON.parse(n);this.responseDiv&&(this.responseDiv.innerHTML=this.inlineEditInstance?this.inlineEditInstance.handleParagraphIndex(t.text):this.markdownIt.render(t.text));this.addPreToolTipsToResponse();this.logInstrument("MessageRendered");this.inputData.enableAutoScrollToTop&&setTimeout(()=>{this.responseDiv&&(this.responseDiv.scrollTo&&this.responseDiv.scrollTo({top:0,behavior:"smooth"}),this.handleResponseScroll())},0)}addPreToolTipsToResponse(){var n;if((n=this.inputData)===null||n===void 0?void 0:n.enableCodeToolTips){const t=_d.querySelector(".b_crtrm_code_header");if(!t)return;const n=this.contentDiv.querySelectorAll("pre");n===null||n===void 0?void 0:n.forEach(n=>{var i;if(n.setAttribute("data-priority","2"),n.childElementCount===1){const r=t.cloneNode(!0);n.insertBefore(r,n.firstChild);const u=r.querySelector("button.b_crtrm_pcopy");if(u){u.onclick=n=>{this.onPreCopy(n)};const f=r.querySelector(".b_crtrm_code_title"),e=n.querySelector("code");if(f&&e){let n=(i=e.className)===null||i===void 0?void 0:i.split("language-"),t="";n&&n.length==2&&(t=n[1].charAt(0).toUpperCase()+n[1].slice(1));f.innerText=t}}}});return}const i=this.contentDiv.querySelector("button.b_crtrm_pcopy");if(i){const t=this.contentDiv.querySelectorAll("pre");t===null||t===void 0?void 0:t.forEach(n=>{if(n.setAttribute("data-priority","2"),n.childElementCount===1){const t=i.cloneNode(!0);n.insertBefore(t,n.firstChild);t.onclick=n=>{this.onPreCopy(n)}}})}}onPreCopy(n){const t=n.currentTarget,i=t===null||t===void 0?void 0:t.parentElement,r=i===null||i===void 0?void 0:i.querySelector("code");if(r)if(navigator.clipboard){const n=new Blob([r.innerText],{type:"text/plain"}),t=new ClipboardItem({"text/plain":n});navigator.clipboard.write([t])}else this.copyToClipboardByCommand(r)}copyToClipboardByCommand(n){var i;const t=_d.getSelection(),r=_d.createRange();r.selectNodeContents(n);t===null||t===void 0?void 0:t.removeAllRanges();t===null||t===void 0?void 0:t.addRange(r);_d.execCommand("copy");(i=window.getSelection())===null||i===void 0?void 0:i.removeAllRanges()}handleUndoClick(){this.responseIndex<=0||(this.logInstrument("UndoButtonClick","Click"),this.responseIndex--,this.switchResponse())}handleRedoClick(){this.responseIndex>=this.responses.length-1||(this.logInstrument("RedoButtonClick","Click"),this.responseIndex++,this.switchResponse())}handleCopyClick(){if(this.logInstrument("CopyButtonClick","Click"),this.sendAPSAT("CopyButtonClick"),navigator.clipboard){const n=new ClipboardItem({"text/html":new Blob([this.responseDiv.innerHTML],{type:"text/html"}),"text/plain":new Blob([this.responseDiv.innerText],{type:"text/plain"})});navigator.clipboard.write([n]);this.logInstrument("CopySucceed")}else this.copyToClipboardByCommand(this.responseDiv)}handleDocxExportClick(n){return __awaiter(this,void 0,void 0,function*(){this.logInstrument("Export","Click");const t=n.dataset.exportmode||ExportHelper.ExportMode.LocalWord,r=n.dataset.enablewordaugloop==="true"||!1,u=this.responseDiv,i=this.responses[this.responseIndex]||"",f=i?JSON.parse(i).text:"";(t===ExportHelper.ExportMode.LocalWord||t===ExportHelper.ExportMode.OnlineWord||t===ExportHelper.ExportMode.OnlineWord1st)&&ExportHelper.handleExportToWord(t,u,f,r)})}handleExportToolbarClick(){this.logInstrument("ExportToolbar","Click");this.sendAPSAT("ExportToolbarClick");this.toggleExportDropdown()}toggleExportDropdown(){if(this.exportDropdown){const n=this.isDropdownVisible(this.exportDropdown);n?this.hideExportDropdown():this.exportToolbar&&!this.exportToolbar.disabled&&this.showExportDropdown()}}isDropdownVisible(n){return!n.classList.contains("b_hide")}showExportDropdown(){this.exportDropdown&&(this.positionDropdown(this.exportDropdown),this.exportDropdown.classList.remove("b_hide"),this.setupDropdownCloseHandlers())}positionDropdown(n){const t=this.exportToolbar.getBoundingClientRect(),e=window.innerHeight,o=window.innerWidth;n.style.left=`${t.left-12}px`;n.style.top=`${t.bottom}px`;n.style.visibility="hidden";n.classList.remove("b_hide");const s=n.getBoundingClientRect(),i=s.height,h=s.width;let r=t.left-12,u=t.bottom,f=!1;if(t.bottom+i>e-10)if(t.top-i>=10)u=t.top-i,f=!0;else{const n=e-t.bottom,r=t.top;r>n?(u=Math.max(10,t.top-i),f=!0):u=Math.min(t.bottom,e-i-10)}r+h>o-10?r=Math.max(10,o-h-10):r<10&&(r=10);n.style.left=`${r}px`;n.style.top=`${u}px`;n.style.visibility="visible";n.classList.toggle("b_crtrm_exp_dropdown_above",f);n.classList.toggle("b_crtrm_exp_dropdown_below",!f)}hideExportDropdown(){this.exportDropdown&&(this.exportDropdown.classList.add("b_hide"),this.removeDropdownCloseHandlers())}attachOptionEventListeners(n){const t=(n===null||n===void 0?void 0:n.dataset.exportmode)||null;n.addEventListener("click",()=>{this.handleOptionSelection(t)});n.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),this.handleOptionSelection(t))})}handleOptionSelection(n){n&&this.handleExportOption(n);this.hideExportDropdown()}setupDropdownCloseHandlers(){const n=this.createCloseHandlers();this.dropdownCloseHandlers=n;this.attachCloseHandlers(n)}createCloseHandlers(){return{closeDropdown:n=>this.handleOutsideClick(n),closeOnEscape:n=>this.handleEscapeKey(n),repositionOrClose:()=>this.hideExportDropdown()}}handleOutsideClick(n){const t=n.target;!this.exportDropdown||this.exportDropdown.contains(t)||this.exportToolbar.contains(t)||this.hideExportDropdown()}handleEscapeKey(n){n.key==="Escape"&&this.hideExportDropdown()}attachCloseHandlers(n){setTimeout(()=>{_d.addEventListener("click",n.closeDropdown),_d.addEventListener("keydown",n.closeOnEscape),_w.addEventListener("scroll",n.repositionOrClose),_w.addEventListener("resize",n.repositionOrClose)},0)}removeDropdownCloseHandlers(){this.dropdownCloseHandlers&&(_d.removeEventListener("click",this.dropdownCloseHandlers.closeDropdown),_d.removeEventListener("keydown",this.dropdownCloseHandlers.closeOnEscape),_w.removeEventListener("scroll",this.dropdownCloseHandlers.repositionOrClose),_w.removeEventListener("resize",this.dropdownCloseHandlers.repositionOrClose),this.dropdownCloseHandlers=null)}handleExportOption(n){var t,i,r;return __awaiter(this,void 0,void 0,function*(){this.logInstrument("ExportOption","Click",{exportMode:n});this.showExportStatus();const f=this.responseDiv;try{switch(n){case ExportHelper.ExportMode.PDF:yield ExportHelper.exportToPDF(f,(t=this.inputData)===null||t===void 0?void 0:t.userQuery);break;case ExportHelper.ExportMode.LocalWord:case ExportHelper.ExportMode.OnlineWord:case ExportHelper.ExportMode.OnlineWord1st:const n=(i=this.exportDropdown)===null||i===void 0?void 0:i.querySelector('[data-export-type="DOCX"]');n&&(yield this.handleDocxExportClick(n));break;case ExportHelper.ExportMode.Text:yield ExportHelper.exportToText(f,(r=this.inputData)===null||r===void 0?void 0:r.userQuery)}this.logInstrument("ExportSucceed","Export",{exportMode:n});this.hideExportStatus()}catch(u){this.logInstrument("ExportFailed","Error",{exportMode:n,error:(u===null||u===void 0?void 0:u.message)||u});this.hideExportStatus()}})}showExportStatus(){var n;const t=_d.getElementById("bCusExportStatus");t&&((n=this.exportToolbar)===null||n===void 0?void 0:n.classList.add("b_hide"),t.classList.remove("b_hide"))}hideExportStatus(){var n;const t=_d.getElementById("bCusExportStatus");t&&(t.classList.add("b_hide"),(n=this.exportToolbar)===null||n===void 0?void 0:n.classList.remove("b_hide"))}handleEditClick(){this.logInstrument("EditButtonClick","Click");this.sendAPSAT("EditButtonClick");this.toggleEditOverlay()}toggleEditOverlay(){var n,t;(n=_d.getElementById("crtrmDrawer"))===null||n===void 0?void 0:n.classList.toggle("active");(t=this.editOverlayMask)===null||t===void 0?void 0:t.classList.toggle("active")}handleRecreateClick(){var n;this.isCached=!1;this.logInstrument("RecreateButtonClick","Click");this.sendAPSAT("RecreateButtonClick");const{selectedConcatStr:t,selectedFieldLabels:i}=this.getSelectedCustomizeOptions();this.inputData.isMobile&&this.toggleEditOverlay();this.inputData.customizationMode="Generic";this.inputData.refineContent="";this.pollingCustomization(t,i);((n=this.inputData)===null||n===void 0?void 0:n.enableSwitchModel)&&(this.setSwitchModel(),this.isFirstModelSwitch=!0)}handleResponseScroll(){this.handleScroll(this.responseDiv,_d.querySelector(".b_cnt_mask"))}handleCustomizeScroll(){this.handleScroll(this.customizeDiv,_d.querySelector(".b_cus_mask"))}handleScroll(n,t){if(n&&t){const i=n.scrollHeight>n.clientHeight,r=n.scrollTop+n.clientHeight>=n.scrollHeight-1;t.style.display=!i||r?"none":"block"}}pollingMessage(n="",i=""){var r,u,f;const o=t(this.inputData.userQuery);if(!o)throw new Error("Current query is empty");const e={query:o,traceId:i,answerKey:n,language:(r=_G.Lang)!==null&&r!==void 0?r:"en",region:(u=_G.Region)!==null&&u!==void 0?u:"us",isCustomized:!1};((f=this.inputData)===null||f===void 0?void 0:f.enableSwitchModel)&&(e.modelName=this.modelName||(sj_cook===null||sj_cook===void 0?void 0:sj_cook.get(this.llmModelCookieKey,this.llmModelCrumbKey)),e.llmResponseModelName=this.llmResponseModelName);this.polling.sendRequest(e)}pollingCustomization(n,i){var r,u,f;const h=t(this.inputData.userQuery);if(!h)throw new Error("Current query is empty");this.inputData.customizationMode!=="Inline"&&(this.loading=!0,this.handleToggleCancelButton(!0));const{traceId:e,answerKey:o}=this.polling.getLastResponse()||{},s={query:h,configForCache:i,configForPrompt:n,traceId:e!==null&&e!==void 0?e:this.inputData.traceId,answerKey:o!==null&&o!==void 0?o:this.inputData.answerKey,language:(r=_G.Lang)!==null&&r!==void 0?r:"en",region:(u=_G.Region)!==null&&u!==void 0?u:"us",contentType:this.inputData.contentType,isCustomized:!0,customizationMode:this.inputData.customizationMode,refineContent:this.inputData.refineContent};((f=this.inputData)===null||f===void 0?void 0:f.enableSwitchModel)&&(s.modelName=this.modelName||"",s.llmResponseModelName=this.llmResponseModelName);this.polling.sendRequest(s)}handlePollingResponse(n){n&&(n.modelResponse&&(this.inlineEditInstance&&this.inputData.customizationMode==="Inline"?this.inlineEditInstance.updateParagraphPreviewContent(!0,n.modelResponse):this.addResponse(n.modelResponse)),!n.modelResponse&&n.isCustomization&&this.pollingMessage(n.answerKey,n.traceId))}handleToggleCancelButton(n){var t,i,r,u;this.cancelBtn&&this.recreateBtn&&(n?((t=this.cancelBtn)===null||t===void 0?void 0:t.classList.remove("b_hide"),(i=this.recreateBtn)===null||i===void 0?void 0:i.classList.add("b_hide")):((r=this.cancelBtn)===null||r===void 0?void 0:r.classList.add("b_hide"),(u=this.recreateBtn)===null||u===void 0?void 0:u.classList.remove("b_hide")))}handleCancelClick(){this.logInstrument("CancelButtonClick","Click");this.sendAPSAT("CancelButtonClick");this.polling.cancel()}handleError(n){this.inlineEditInstance&&this.inputData.customizationMode==="Inline"?this.inlineEditInstance.updateParagraphPreviewContent(!1,n===null||n===void 0?void 0:n.message):(this.loading=!1,this.handleToggleCancelButton(!1),this.responseDiv&&(n===null||n===void 0?void 0:n.message)&&(this.responseDiv.innerHTML=`<span>${n.message}</span>`))}toggleLoading(n){var i,r,u,f,e;this.contentDiv&&(this.contentDiv.style.display=n?"none":"flex");this.loadingDiv&&(this.loadingDiv.style.display=n?"flex":"none");const t=(i=this.fullscreenView)===null||i===void 0?void 0:i.querySelector(".b_crtrm_content_wrapper");this.inputData.isMobile&&((r=this.fullscreenView)===null||r===void 0?void 0:r.classList.contains("active"))&&t&&(n?(t.innerHTML="",t.appendChild((u=this.loadingDiv)===null||u===void 0?void 0:u.cloneNode(!0))):t.innerHTML=(f=this.contentDiv)===null||f===void 0?void 0:f.innerHTML);((e=this.inputData)===null||e===void 0?void 0:e.showAuthVerified)?this.setActionAndCustomizePanel(!0):this.setActionAndCustomizePanel(n)}setActionAndCustomizePanel(n){var t,i,r,u,f;if(this.recreateBtn&&(this.recreateBtn.disabled=n),this.copyBtn&&(this.copyBtn.disabled=n),this.exportDisclaimer&&(this.exportDisclaimer.disabled=n),this.editBtn&&(this.editBtn.disabled=n),this.seeAllBtn&&(this.seeAllBtn.disabled=n),this.undoBtn&&((t=this.inputData)===null||t===void 0?void 0:t.enhanceRecreateUX)&&(this.undoBtn.disabled=n||this.responseIndex<=0),this.redoBtn&&((i=this.inputData)===null||i===void 0?void 0:i.enhanceRecreateUX)&&(this.redoBtn.disabled=n||this.responseIndex>=this.responses.length-1),this.exportToolbar&&(this.exportToolbar.disabled=n),(r=this.customizeFields)===null||r===void 0?void 0:r.forEach(t=>t.querySelectorAll("input").forEach(t=>t.disabled=n)),((u=this.inputData)===null||u===void 0?void 0:u.enableSwitchModel)&&((f=this.inputData)===null||f===void 0?void 0:f.enhanceRecreateUX)&&this.modelDropdown){const t=this.modelDropdown.parentElement;if(!t)return;n?t.classList.contains("b_disabled")||t.classList.add("b_disabled"):t.classList.remove("b_disabled")}}getSelectedCustomizeOptions(){var n;const t=[];let i="";return(n=this.customizeFields)===null||n===void 0?void 0:n.forEach(n=>{const u=n.querySelector("input");if(u){const{type:r,name:f}=u;if(r==="checkbox"||r==="radio"){const u=Array.from(n.querySelectorAll(".b_field_options label")),r=u.map(n=>({input:n.querySelector("input"),label:n.querySelector("span")})).filter(({input:n})=>n===null||n===void 0?void 0:n.checked).map(({input:n,label:t})=>({value:n===null||n===void 0?void 0:n.value,label:t===null||t===void 0?void 0:t.innerText}));r.length&&(i+=`
** ${f} : ${r.map(n=>n.value).join(", ")} **
`,t.push(r.map(n=>n.label).join(";")))}else r==="text"}}),{selectedConcatStr:i,selectedFieldLabels:t}}panelInteration(){this.logInstrument("CreatorCard.CustomizationPanelInteraction","InteractionEvent",{query:t(this.inputData.userQuery)})}handleSeeAllClick(){if(this.fullscreenView){this.logInstrument("SeeAllButtonClick","Click");this.sendAPSAT("SeeAllButtonClick");const n=this.fullscreenView.querySelector(".b_crtrm_content_wrapper");n&&(n.innerHTML=this.contentDiv.innerHTML);this.toggleFullscreenView()}}handleBackClick(){this.logInstrument("BackButtonClick","Click");this.sendAPSAT("BackButtonClick");this.toggleFullscreenView()}toggleFullscreenView(){this.fullscreenView&&(this.fullscreenView.classList.toggle("active"),_d.documentElement.style.overflow=this.fullscreenView.classList.contains("active")?"hidden":"")}setSwitchModel(){const n=sj_cook.get(this.llmModelCookieKey,this.llmModelCrumbKey);this.modelName!=n?(this.llmResponseModelName=this.modelName,this.isModelChanged=!0,sj_cook.set(this.llmModelCookieKey,this.llmModelCrumbKey,this.modelName,!0,"/")):this.isModelChanged=!1;this.logInstrument("SwitchModel","Click",{modelName:this.modelName})}logInstrument(n,i="InteractionEvent",r={}){var u,f,e;const o=Object.assign({query:t(this.inputData.userQuery),contentType:this.inputData.contentType,scenario:this.isCached?"Cached":"Polling",region:(u=_G.Region)!==null&&u!==void 0?u:"us",language:(f=_G.Lang)!==null&&f!==void 0?f:"en",mobile:(e=this.inputData.isMobile)!==null&&e!==void 0?e:!1,timestamp:Date.now()},r);Log.Log(i,"CreatorCard",n,!1,"CustomData",JSON.stringify(o))}saveCustomOptionsState(){var n;this.customOptionsState.clear();(n=this.customizeFields)===null||n===void 0?void 0:n.forEach(n=>{const t=n.querySelectorAll("input");t.forEach(n=>{this.customOptionsState.set(n,{checked:n.checked})})})}disableCustomizeFields(){this.customizeFields&&this.customizeFields.forEach(n=>{const t=n.querySelectorAll("input");t.forEach(n=>{n.checked=!1,n.disabled=!0})})}restoreCustomOptionsState(){this.customizeFields&&this.customizeFields.forEach(n=>{const t=n.querySelectorAll("input");t.forEach(n=>{n.disabled=!1;const t=this.customOptionsState.get(n);t&&(n.checked=t.checked)})})}resetModelDropdown(){var i,r,u,t;this.modelName=sj_cook.get(this.llmModelCookieKey,this.llmModelCrumbKey)||"";this.llmResponseModelName=this.modelName;this.isModelChanged=!1;const n=(i=this.modelDropdown)===null||i===void 0?void 0:i.querySelectorAll(".b_fItemDiv");if((n===null||n===void 0?void 0:n.length)>0)for(t=0;t<n.length;t++)(r=n[t].parentElement)===null||r===void 0?void 0:r.setAttribute("aria-selected","false"),(u=n[t].parentElement)===null||u===void 0?void 0:u.classList.remove("b_selected")}sendAPSAT(n,t=true){var i,r;if((i=this.inputData)===null||i===void 0?void 0:i.enhanceInstrumentation){const i=t?"PositiveInteractionEvent":"NegativeInteractionEvent";(r=Log===null||Log===void 0?void 0:Log.Log)===null||r===void 0?void 0:r.call(Log,i,"APSAT",n,!1,"AppNS",this.appNS,"K",this.kVal)}}initInlineEdit(){typeof CreatorCardTextInlineEdit!="undefined"&&(this.inlineEditInstance=new CreatorCardTextInlineEdit.CreatorCardTextInlineEdit(this.answerContainer,this.responseDiv,this.inputData,this.polling,this.markdownIt,this.copyToClipboardByCommand.bind(this),this.logInstrument.bind(this),this.pollingCustomization.bind(this),this.sendAPSAT.bind(this),this.addResponse.bind(this)))}getExpansionElements(){const n=_d.getElementById("b_wpt_container"),t=n===null||n===void 0?void 0:n.querySelector(":scope > .b_acf_answer_expansion_control");return{container:n,expansionControl:t,btn:t===null||t===void 0?void 0:t.querySelector(".acf-button-standard__btn"),cusDiv:_d.querySelector(".b_crtrm_cus")}}initSeeMoreButton(){const{btn:n}=this.getExpansionElements();n&&n.addEventListener("click",()=>{const t=n.getAttribute("aria-expanded")==="true";this.sendAPSAT(t?"SeeMoreButtonClick":"SeeLessButtonClick")})}initCustomHeight(){var n;const{container:i,expansionControl:r,btn:t,cusDiv:u}=this.getExpansionElements();if(i&&r&&u&&t){(n=this.customHeightObserver)===null||n===void 0?void 0:n.disconnect();const f=()=>{const n=t.getAttribute("aria-expanded")==="true";u.style.height=n?"":`${Math.max(0,i.offsetHeight-r.offsetHeight)}px`};f();this.customHeightObserver=new MutationObserver(f);this.customHeightObserver.observe(t,{attributes:!0,attributeFilter:["aria-expanded"]})}}}n.CreatorCardText=i;sj_evt.fire("CreatorCardText_Load",i)})(CreatorCardText||(CreatorCardText={}))